--// UI Moderna de Morph (com drag PC + Mobile) //--

if game.CoreGui:FindFirstChild("MorphUI") then
    game.CoreGui.MorphUI:Destroy()
end

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

-- FunÃ§Ã£o de Drag universal (PC + Mobile)
local function makeDraggable(frame)
	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end

	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

-- CriaÃ§Ã£o da UI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "MorphUI"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.AnchorPoint = Vector2.new(0.5, 0.5)
Frame.Position = UDim2.new(0.5, 0, 0.5, 0)
Frame.Size = UDim2.new(0, 420, 0, 260)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
Frame.BackgroundTransparency = 0.3
Frame.BorderSizePixel = 0
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 15)
Instance.new("UIStroke", Frame).Color = Color3.fromRGB(0, 170, 255)

makeDraggable(Frame)

-- CabeÃ§alho
local Title = Instance.new("TextLabel", Frame)
Title.Text = "ðŸ‘¤ Morph System"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 22
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0, 10)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.TextScaled = false
Title.TextWrapped = false
Title.TextXAlignment = Enum.TextXAlignment.Center

local SubTitle = Instance.new("TextLabel", Frame)
SubTitle.Text = "Use a aparÃªncia de outro jogador"
SubTitle.Font = Enum.Font.Gotham
SubTitle.TextSize = 14
SubTitle.TextColor3 = Color3.fromRGB(160, 160, 160)
SubTitle.Position = UDim2.new(0, 0, 0, 45)
SubTitle.Size = UDim2.new(1, 0, 0, 20)
SubTitle.BackgroundTransparency = 1
SubTitle.TextXAlignment = Enum.TextXAlignment.Center

-- Caixa de texto
local TextBox = Instance.new("TextBox", Frame)
TextBox.PlaceholderText = "Digite o nickname..."
TextBox.Font = Enum.Font.Gotham
TextBox.TextSize = 16
TextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
TextBox.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
TextBox.Position = UDim2.new(0, 20, 0, 85)
TextBox.Size = UDim2.new(0, 380, 0, 40)
TextBox.BackgroundTransparency = 0.2
Instance.new("UICorner", TextBox).CornerRadius = UDim.new(0, 10)
Instance.new("UIStroke", TextBox).Color = Color3.fromRGB(0, 170, 255)

-- BotÃ£o Morph
local MorphButton = Instance.new("TextButton", Frame)
MorphButton.Text = "MORPH"
MorphButton.Font = Enum.Font.GothamBold
MorphButton.TextSize = 18
MorphButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MorphButton.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
MorphButton.Position = UDim2.new(0, 20, 0, 145)
MorphButton.Size = UDim2.new(0, 380, 0, 40)
Instance.new("UICorner", MorphButton).CornerRadius = UDim.new(0, 10)
Instance.new("UIStroke", MorphButton).Color = Color3.fromRGB(0, 180, 255)

-- BotÃ£o Save
local SaveButton = Instance.new("TextButton", Frame)
SaveButton.Text = "ðŸ’¾ Save for Auto Load"
SaveButton.Font = Enum.Font.Gotham
SaveButton.TextSize = 16
SaveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SaveButton.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
SaveButton.Position = UDim2.new(0, 20, 0, 195)
SaveButton.Size = UDim2.new(0, 380, 0, 35)
Instance.new("UICorner", SaveButton).CornerRadius = UDim.new(0, 8)
Instance.new("UIStroke", SaveButton).Color = Color3.fromRGB(100, 100, 150)

---------------------------------------------------------------------
-- FunÃ§Ãµes principais (morph + aparÃªncia)
---------------------------------------------------------------------

local function getChar()
	return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
end

local function getHum()
	local char = getChar()
	return char:FindFirstChildOfClass("Humanoid")
end

local function getHead(char)
	return char:FindFirstChild("Head") or char:FindFirstChild("HumanoidRootPart")
end

local function IsR15()
	local hum = getHum()
	return hum and hum.RigType == Enum.HumanoidRigType.R15
end

local function IsR6()
	local hum = getHum()
	return hum and hum.RigType == Enum.HumanoidRigType.R6
end

local function addAccessory(char, assetId)
	local a = game:GetObjects("rbxassetid://"..assetId)[1]
	if not (a and a:IsA("Accessory")) then return end
	for _,v in ipairs(a:GetDescendants()) do
		if v:IsA("BasePart") then
			v.CanCollide = false
			v.Massless = true
		end
	end
	a.Parent = char
	local handle = a:FindFirstChild("Handle")
	if not handle then return end
	for _, ac in ipairs(handle:GetChildren()) do
		if ac:IsA("Attachment") then
			local ra = char:FindFirstChild(ac.Name, true)
			if ra and ra:IsA("Attachment") then
				handle.CFrame = ra.WorldCFrame * ac.CFrame:Inverse()
				local w = Instance.new("WeldConstraint")
				w.Part0 = ra.Parent
				w.Part1 = handle
				w.Parent = handle
				return
			end
		end
	end
end

local function MorphToUser(username)
	local success, uid = pcall(Players.GetUserIdFromNameAsync, Players, username)
	if not success then return end

	local char = getChar()
	for _, v in ipairs(char:GetChildren()) do
		if v:IsA("Accessory") or v:IsA("CharacterMesh") or v:IsA("Shirt") or v:IsA("Pants") or v:IsA("ShirtGraphic") then
			v:Destroy()
		end
	end

	local desc = Players:GetHumanoidDescriptionFromUserId(uid)
	local appearance = Players:GetCharacterAppearanceAsync(uid)

	for _, info in ipairs(desc:GetAccessories(true)) do
		addAccessory(char, info.AssetId)
	end

	local hum = getHum()
	if hum and hum:FindFirstChild("HumanoidDescription") then
		local pd = hum.HumanoidDescription
		pd.BodyTypeScale = desc.BodyTypeScale
		pd.DepthScale = desc.DepthScale
		pd.HeadScale = desc.HeadScale
		pd.HeightScale = desc.HeightScale
		pd.ProportionScale = desc.ProportionScale
		pd.WidthScale = desc.WidthScale
	end

	local bc = char:FindFirstChildOfClass("BodyColors")
	if bc then
		bc.HeadColor3 = desc.HeadColor
		bc.LeftArmColor3 = desc.LeftArmColor
		bc.LeftLegColor3 = desc.LeftLegColor
		bc.RightArmColor3 = desc.RightArmColor
		bc.RightLegColor3 = desc.RightLegColor
		bc.TorsoColor3 = desc.TorsoColor
	end

	local head = getHead(char)
	if head then
		for _, dec in ipairs(head:GetChildren()) do
			if dec:IsA("Decal") then dec:Destroy() end
		end
	end

	for _, v in ipairs(appearance:GetDescendants()) do
		if IsR6() and (v:IsA("CharacterMesh") or v:IsA("SpecialMesh")) then
			v:Clone().Parent = char
		elseif IsR15() and v:IsA("MeshPart") then
			local tp = char:FindFirstChild(v.Name)
			if tp then 
				tp.MeshId = v.MeshId 
				tp.TextureID = v.TextureID 
			end
		elseif v:IsA("Shirt") or v:IsA("Pants") or v:IsA("ShirtGraphic") then
			v:Clone().Parent = char
		elseif v:IsA("Decal") and v.Name:lower() == "face" then
			v:Clone().Parent = head
		end
	end
end

---------------------------------------------------------------------
-- BotÃµes
---------------------------------------------------------------------

MorphButton.MouseButton1Click:Connect(function()
	local user = TextBox.Text
	if user == "" then return end
	MorphToUser(user)
end)

SaveButton.MouseButton1Click:Connect(function()
	local user = TextBox.Text
	if user == "" then return end
	writefile("MorphAutoLoad.txt", user)
	SaveButton.Text = "âœ… Salvo!"
	task.wait(1.5)
	SaveButton.Text = "ðŸ’¾ Save for Auto Load"
end)

-- Auto Load
if pcall(function() return readfile("MorphAutoLoad.txt") end) then
	local saved = readfile("MorphAutoLoad.txt")
	if saved and saved ~= "" then
		TextBox.Text = saved
		MorphToUser(saved)
	end
end
