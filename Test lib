-- FrostyHubLib.lua
-- Biblioteca modular do FrostyHub
local FrostyHub = {}
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local MarketplaceService = game:GetService("MarketplaceService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = gethui and gethui() or player:WaitForChild("PlayerGui")

-- Helper: criação rápida de Instâncias
local function I(class, props)
	local obj = Instance.new(class)
	for k, v in pairs(props or {}) do
		if k == "Parent" then
			obj.Parent = v
		else
			obj[k] = v
		end
	end
	return obj
end

-- Variáveis internas
local ui = {}
local autoJoinEnabled = false
local hasPremium = false

-- Função principal: inicializar UI
function FrostyHub.Init()
	if ui.ScreenGui then return end

	ui.ScreenGui = I("ScreenGui", {
		Name = "FrostyHubGUI",
		ResetOnSpawn = false,
		Parent = playerGui,
	})

	-- ======= BOTÃO SUPERIOR =======
	ui.TopButton = I("TextButton", {
		Parent = ui.ScreenGui,
		AnchorPoint = Vector2.new(0.5, 0),
		Position = UDim2.new(0.5, 0, 0.02, 0),
		Size = UDim2.new(0.8, 0, 0.07, 0),
		BackgroundColor3 = Color3.fromRGB(37, 104, 170),
		Text = "Click here to open Frosty Hub",
		TextColor3 = Color3.fromRGB(255,255,255),
		Font = Enum.Font.GothamBold,
		TextSize = 18,
	})
	I("UICorner", {Parent = ui.TopButton, CornerRadius = UDim.new(0, 22)})

	-- ======= JANELA PRINCIPAL =======
	ui.MainFrame = I("Frame", {
		Parent = ui.ScreenGui,
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = UDim2.new(0.5, 0, 0.5, 0),
		Size = UDim2.new(0.6, 0, 0.7, 0),
		BackgroundColor3 = Color3.fromRGB(10,10,10),
		Visible = false,
	})
	I("UICorner", {Parent = ui.MainFrame, CornerRadius = UDim.new(0, 18)})

	-- ======= DRAG =======
	do
		local dragging, dragInput, dragStart, startPos
		local function update(input)
			local delta = input.Position - dragStart
			ui.MainFrame.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
		ui.MainFrame.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				dragging = true
				dragStart = input.Position
				startPos = ui.MainFrame.Position
				input.Changed:Connect(function()
					if input.UserInputState == Enum.UserInputState.End then
						dragging = false
					end
				end)
			end
		end)
		ui.MainFrame.InputChanged:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseMovement then
				dragInput = input
			end
		end)
		UserInputService.InputChanged:Connect(function(input)
			if input == dragInput and dragging then
				update(input)
			end
		end)
	end

	-- ======= BARRA SUPERIOR =======
	local topBar = I("Frame", {
		Parent = ui.MainFrame,
		Size = UDim2.new(1, 0, 0, 48),
		BackgroundTransparency = 1,
	})
	local title = I("TextLabel", {
		Parent = topBar,
		Position = UDim2.new(0, 12, 0, 8),
		Size = UDim2.new(0.8, -24, 1, -16),
		BackgroundTransparency = 1,
		Text = "Frosty Hub | Mirrors aka Kollin",
		TextColor3 = Color3.fromRGB(255,255,255),
		Font = Enum.Font.GothamBold,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
	})
	local closeBtn = I("TextButton", {
		Parent = topBar,
		AnchorPoint = Vector2.new(1, 0.5),
		Position = UDim2.new(1, -12, 0.5, 0),
		Size = UDim2.new(0, 34, 0, 34),
		BackgroundColor3 = Color3.fromRGB(30,30,30),
		Text = "✕",
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextColor3 = Color3.fromRGB(255,255,255),
	})
	I("UICorner", {Parent = closeBtn, CornerRadius = UDim.new(0, 16)})

	-- ======= SIDEBAR =======
	local leftBar = I("Frame", {
		Parent = ui.MainFrame,
		Position = UDim2.new(0, 12, 0, 60),
		Size = UDim2.new(0, 220, 1, -72),
		BackgroundColor3 = Color3.fromRGB(16,16,16),
	})
	I("UICorner", {Parent = leftBar, CornerRadius = UDim.new(0, 14)})
	I("UIListLayout", {Parent = leftBar, Padding = UDim.new(0, 12)})

	-- Botões de abas
	local tabAuto = I("TextButton", {
		Parent = leftBar,
		Size = UDim2.new(1, -24, 0, 48),
		BackgroundColor3 = Color3.fromRGB(60,60,60),
		Text = "Auto Joiner",
		Font = Enum.Font.Gotham,
		TextColor3 = Color3.fromRGB(255,255,255),
		TextSize = 16,
	})
	I("UICorner", {Parent = tabAuto, CornerRadius = UDim.new(0, 10)})

	local tabMisc = I("TextButton", {
		Parent = leftBar,
		Size = UDim2.new(1, -24, 0, 48),
		BackgroundColor3 = Color3.fromRGB(34,34,34),
		Text = "Misc",
		Font = Enum.Font.Gotham,
		TextColor3 = Color3.fromRGB(230,230,230),
		TextSize = 16,
	})
	I("UICorner", {Parent = tabMisc, CornerRadius = UDim.new(0, 10)})

	-- ======= CARTÃO PERFIL =======
	local bottomInfo = I("Frame", {
		Parent = leftBar,
		Size = UDim2.new(1, -24, 0, 96),
		BackgroundColor3 = Color3.fromRGB(28,28,28),
	})
	I("UICorner", {Parent = bottomInfo, CornerRadius = UDim.new(0, 14)})

	local avatar = I("ImageLabel", {
		Parent = bottomInfo,
		Position = UDim2.new(0, 8, 0.5, -28),
		Size = UDim2.new(0, 64, 0, 64),
		BackgroundTransparency = 1,
		Image = "rbxasset://textures/ui/GuiImagePlaceholder.png",
	})
	local nameLabel = I("TextLabel", {
		Parent = bottomInfo,
		Position = UDim2.new(0, 80, 0.25, 0),
		Size = UDim2.new(1, -88, 0.6, 0),
		BackgroundTransparency = 1,
		Text = player.Name .. "\nFetching game name...",
		TextColor3 = Color3.fromRGB(150,255,160),
		Font = Enum.Font.Gotham,
		TextSize = 14,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextWrapped = true,
	})

	-- Avatar correto
	spawn(function()
		pcall(function()
			local thumbUrl, ready = Players:GetUserThumbnailAsync(
				player.UserId,
				Enum.ThumbnailType.HeadShot,
				Enum.ThumbnailSize.Size150x150
			)
			if ready then
				avatar.Image = thumbUrl
			end
		end)
	end)

	-- Nome do jogo
	spawn(function()
		local ok, info = pcall(function()
			return MarketplaceService:GetProductInfo(game.PlaceId)
		end)
		if ok and info and info.Name then
			nameLabel.Text = player.Name .. "\nPlaying " .. info.Name
		else
			nameLabel.Text = player.Name .. "\nPlaying game ID " .. game.PlaceId
		end
	end)

	-- ======= CONTEÚDO DIREITO =======
	local rightPanel = I("Frame", {
		Parent = ui.MainFrame,
		Position = UDim2.new(0, 244, 0, 60),
		Size = UDim2.new(1, -260, 1, -72),
		BackgroundColor3 = Color3.fromRGB(12,12,12),
	})
	I("UICorner", {Parent = rightPanel, CornerRadius = UDim.new(0, 14)})

	-- Scroll
	local scroll = I("ScrollingFrame", {
		Parent = rightPanel,
		Size = UDim2.new(1, -24, 1, -24),
		Position = UDim2.new(0, 12, 0, 12),
		BackgroundTransparency = 1,
		ScrollBarThickness = 6,
	})
	I("UIListLayout", {Parent = scroll, Padding = UDim.new(0, 12)})

	-- ======= ABA AUTOJOIN =======
	local autoSection = I("Frame", {
		Parent = scroll,
		Size = UDim2.new(1, 0, 0, 240),
		BackgroundColor3 = Color3.fromRGB(18,18,18),
	})
	I("UICorner", {Parent = autoSection, CornerRadius = UDim.new(0, 10)})

	local keyBox = I("TextBox", {
		Parent = autoSection,
		Position = UDim2.new(0, 16, 0, 40),
		Size = UDim2.new(0.7, 0, 0, 36),
		BackgroundColor3 = Color3.fromRGB(24,24,24),
		PlaceholderText = "Enter License Key...",
		TextColor3 = Color3.fromRGB(255,255,255),
		Font = Enum.Font.Gotham,
		TextSize = 14,
	})
	I("UICorner", {Parent = keyBox, CornerRadius = UDim.new(0, 8)})

	local redeem = I("TextButton", {
		Parent = autoSection,
		Position = UDim2.new(0.75, 0, 0, 40),
		Size = UDim2.new(0.2, 0, 0, 36),
		BackgroundColor3 = Color3.fromRGB(40,160,80),
		Text = "Redeem",
		TextColor3 = Color3.fromRGB(255,255,255),
		Font = Enum.Font.GothamBold,
		TextSize = 14,
	})
	I("UICorner", {Parent = redeem, CornerRadius = UDim.new(0, 8)})

	redeem.MouseButton1Click:Connect(function()
		local key = keyBox.Text
		if #key >= 6 then
			hasPremium = true
			redeem.Text = "Redeemed"
			redeem.BackgroundColor3 = Color3.fromRGB(80,200,100)
		else
			redeem.Text = "Invalid"
			redeem.BackgroundColor3 = Color3.fromRGB(200,60,60)
			task.wait(1)
			redeem.Text = "Redeem"
			redeem.BackgroundColor3 = Color3.fromRGB(40,160,80)
		end
	end)

	-- Toggle Auto Join
	local toggle = I("TextButton", {
		Parent = autoSection,
		Position = UDim2.new(0, 16, 0, 96),
		Size = UDim2.new(0, 56, 0, 28),
		BackgroundColor3 = Color3.fromRGB(40,40,40),
		Text = "",
	})
	I("UICorner", {Parent = toggle, CornerRadius = UDim.new(1, 8)})
	local circle = I("Frame", {
		Parent = toggle,
		Size = UDim2.new(0, 22, 0, 22),
		Position = UDim2.new(0, 4, 0.5, -11),
		BackgroundColor3 = Color3.fromRGB(200,200,200),
	})
	I("UICorner", {Parent = circle, CornerRadius = UDim.new(1, 12)})

	local function setToggle(on)
		autoJoinEnabled = on
		if on then
			circle:TweenPosition(UDim2.new(1, -26, 0.5, -11), "Out", "Quad", 0.15, true)
			toggle.BackgroundColor3 = Color3.fromRGB(60,160,80)
		else
			circle:TweenPosition(UDim2.new(0, 4, 0.5, -11), "Out", "Quad", 0.15, true)
			toggle.BackgroundColor3 = Color3.fromRGB(40,40,40)
		end
	end

	toggle.MouseButton1Click:Connect(function()
		setToggle(not autoJoinEnabled)
	end)

	-- Loop simulado
	task.spawn(function()
		while true do
			if autoJoinEnabled then
				print("[AutoJoin] Searching servers...")
				task.wait(hasPremium and 3 or 6)
			else
				task.wait(0.5)
			end
		end
	end)

	-- Botões de abrir/fechar
	local function toggleHub()
		local visible = not ui.MainFrame.Visible
		ui.MainFrame.Visible = visible
		ui.TopButton.Text = visible and "Click here to close Frosty Hub" or "Click here to open Frosty Hub"
		ui.TopButton.BackgroundColor3 = visible and Color3.fromRGB(220,60,60) or Color3.fromRGB(37,104,170)
	end

	ui.TopButton.MouseButton1Click:Connect(toggleHub)
	closeBtn.MouseButton1Click:Connect(toggleHub)

	print("[FrostyHub] Initialized.")
end

return FrostyHub
